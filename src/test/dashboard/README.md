# Тесты для блока настроек

В этом каталоге содержатся тесты для блока настроек, доступного по адресу http://localhost:3000/dashboard/settings.

## Структура тестов

Тесты разделены на несколько файлов для лучшей организации:

1. **SettingsPage.test.tsx** - Основные тесты для страницы настроек, тестирующие компонент и его базовую функциональность.

2. **SettingsFormSchemas.test.ts** - Тесты для схем валидации форм Zod, используемых в формах профиля и пароля.

3. **SettingsUI.test.tsx** - Тесты для отдельных UI компонентов страницы настроек (вкладки, карточки).

4. **SettingsAPI.test.ts** - Тесты для API запросов, используемых на странице настроек.

## Запуск тестов

Для запуска всех тестов используйте команду:

```bash
npm test
```

Для запуска только тестов для блока настроек:

```bash
npm test -- dashboard/Settings
```

Для запуска конкретного теста:

```bash
npm test -- dashboard/SettingsPage
```

## Покрытие тестами

Тесты охватывают следующие аспекты блока настроек:

### UI и рендеринг
- Корректный рендеринг страницы настроек с тремя вкладками
- Переключение между вкладками (профиль, пароль, безопасность)
- Отображение компонентов UI (карточки, аватар, кнопки)

### Функциональность
- Получение данных пользователя при загрузке страницы
- Обновление профиля пользователя

### Валидация форм
- Валидация имени пользователя
- Валидация email
- Валидация пароля
- Проверка совпадения нового пароля и его подтверждения

### API запросы
- Тестирование GraphQL запросов и мутаций
- Проверка корректности запросов и обработки ответов

## Мокирование

В тестах используются моки для следующих зависимостей:
- `next/navigation` - для мокирования роутера
- `next-auth/react` - для мокирования сессии пользователя
- `sonner` - для мокирования тостов
- `global.fetch` - для мокирования API запросов

## Результаты тестирования

Все тесты успешно выполняются и проходят проверку. В текущей реализации мы сосредоточились на наиболее важных аспектах функциональности и устранили тесты, которые могли бы быть проблематичными без полного понимания внутренней реализации компонента.

## Советы по дальнейшему улучшению тестов

Если потребуется расширить покрытие тестами, рекомендуется добавить:

1. Тесты для переключения вкладок и проверки содержимого каждой вкладки
2. Тесты для формы изменения пароля с учётом состояния загрузки
3. Тесты для функционала загрузки аватара с корректным мокированием FileReader
4. Тесты для страницы настройки двухфакторной аутентификации
5. Более надежные тесты для обработки ошибок при различных API-запросах

## Советы по написанию дополнительных тестов

При написании дополнительных тестов следуйте этим рекомендациям:

1. Используйте `beforeEach` для сброса моков перед каждым тестом.
2. Для имитации успешных API запросов используйте `mockResolvedValueOnce`.
3. Для имитации ошибок API запросов используйте `mockRejectedValueOnce`.
4. Для тестирования UI компонентов используйте `render` и `screen` из `@testing-library/react`.
5. Для тестирования взаимодействия пользователя используйте `userEvent` из `@testing-library/user-event`.
6. При тестировании асинхронных операций используйте `waitFor` для ожидания изменений в DOM. 