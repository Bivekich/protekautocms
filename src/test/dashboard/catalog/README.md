# Тесты каталога товаров

В этой директории содержатся тесты для компонентов и функциональности каталога товаров в административной панели.

## Структура тестов

- `CatalogPage.test.tsx` - тесты для основной страницы каталога
- `CatalogSidebar.test.tsx` - тесты для боковой панели с категориями
- `CategoryContent.test.tsx` - тесты для компонента содержимого категории
- `ProductsList.test.tsx` - тесты для списка товаров
- `ImportExport.test.tsx` - тесты для функциональности импорта/экспорта

## Запуск тестов

Для запуска всех тестов каталога выполните:

```bash
npm run test:catalog
```

Для запуска конкретного теста:

```bash
npm run test:catalog:page  # Запускает только тесты CatalogPage
# или
npm run test -- src/test/dashboard/catalog/CatalogPage.test.tsx
```

Для запуска тестов в режиме наблюдения (watch mode):

```bash
npm run test:watch -- src/test/dashboard/catalog
```

## Известные проблемы тестирования

1. **Проблемы с Next/Image**: Компонент Image из Next.js вызывает ошибки в тестах из-за недействительных URL. Для решения этой проблемы мы добавили мок Next/Image в файле `ProductsList.test.tsx`.

2. **Проблемы с URL в JSDOM**: Тесты могут выдавать ошибку `Invalid base URL` при использовании URL API. Мы добавили мок для `global.URL.createObjectURL`.

3. **Проблемы с API тестированием**: Некоторые тесты, взаимодействующие с API, отмечены как `skip` из-за проблем с моками API запросов.

4. **Предупреждения act()**: При выполнении тестов могут появляться предупреждения "An update to Component inside a test was not wrapped in act(...)". Это связано с асинхронными обновлениями в компонентах. Для решения следует использовать `act()` при выполнении действий, вызывающих обновление состояния, и `waitFor()` для ожидания завершения этих обновлений.

   ```javascript
   import { act } from '@testing-library/react';
   
   // Пример использования act()
   await act(async () => {
     fireEvent.click(button);
   });
   
   // Или с waitFor
   await waitFor(() => {
     expect(element).toBeInTheDocument();
   });
   ```

## Рекомендации по написанию тестов

1. **Добавление data-testid атрибутов**: При разработке компонентов следует добавлять атрибуты `data-testid` для ключевых элементов, что упрощает их поиск в тестах.

2. **Мокирование внешних зависимостей**: Всегда мокируйте внешние зависимости, такие как API запросы, Next.js компоненты и т.д.

3. **Избегайте сложных селекторов**: Вместо сложных CSS-селекторов используйте `getByTestId`, `getByRole` или `getByText`.

4. **Создание параметризованных тестов**: Для тестирования похожей функциональности с разными данными используйте параметризованные тесты.

5. **Оборачивание асинхронных действий**: Все действия, вызывающие обновление состояния компонентов (например, клики, ввод текста), должны быть обернуты в `act()` или использоваться вместе с `waitFor()` для корректного тестирования.

6. **Избегайте дублирования селекторов текста**: Если в компоненте есть повторяющиеся тексты, используйте более специфичные селекторы, например `getByRole` с дополнительными параметрами.

## Покрытие тестами

Тесты охватывают следующие аспекты каталога товаров:

### CatalogPage
- Рендеринг компонента со вкладками
- Переключение между вкладками
- Выбор категорий

### CatalogSidebar
- Отображение списка категорий
- Выделение выбранной категории
- Разворачивание/сворачивание категорий
- Отображение скрытых категорий

### CategoryContent
- Отображение подкатегорий
- Функциональность добавления товаров и подкатегорий
- Поиск товаров

### ProductsList
- Отображение списка товаров
- Выбор товаров и операции над выбранными товарами
- Фильтрация товаров
- Пагинация
- Переключение видимости товаров

### ImportExport
- Загрузка файла для импорта
- Экспорт товаров
- Обработка ошибок 