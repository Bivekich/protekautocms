# Простая инструкция по деплою ProtekAutoCMS через Portainer

## 1. Подготовка файлов

Убедитесь, что у вас есть следующие файлы:
- `Dockerfile`
- `docker-compose.yml`
- `stack.env`
- `docker-entrypoint.sh`

## 2. Настройка переменных окружения

Отредактируйте файл `stack.env`, указав правильные значения для:
- `DATABASE_URL` - строка подключения к вашей базе данных
- `NEXTAUTH_URL` - URL вашего сайта
- `NEXT_PUBLIC_API_URL` - URL вашего API (обычно совпадает с URL сайта)

## 3. Деплой через Portainer

1. Загрузите все файлы проекта на сервер, включая:
   - `Dockerfile`
   - `docker-compose.yml`
   - `stack.env`
   - `docker-entrypoint.sh`
   - Все файлы исходного кода

2. В Portainer выберите "Stacks" > "Add stack"

3. Загрузите `docker-compose.yml` или вставьте его содержимое

4. Убедитесь, что Portainer видит файл `stack.env`

5. Нажмите "Deploy the stack"

6. Сборка образа может занять некоторое время (5-10 минут). Следите за логами в Portainer.

## 4. Проверка деплоя

После деплоя проверьте:
- Контейнер запущен и работает
- Сайт доступен по указанному домену

## 5. Устранение проблем

Если возникают проблемы при сборке или запуске:

1. **Проблемы с установкой зависимостей**:
   Проверьте логи в Portainer. Если возникают ошибки с установкой пакетов, попробуйте запустить сборку с опцией `--no-cache`:
   ```
   В Portainer: Stack > Редактировать стек > Включить опцию "Force the redeployment of all services"
   ```

2. **Проблемы с соединением с базой данных**:
   Убедитесь, что строка подключения в `stack.env` корректна и база данных доступна.

3. **Другие проблемы**:
   Проверьте логи контейнера в Portainer для определения причины ошибки.

## 6. Обновление приложения

Для обновления приложения:
1. Загрузите новые файлы исходного кода на сервер
2. В Portainer нажмите "Redeploy the stack" с опцией "Force the redeployment of all services" 